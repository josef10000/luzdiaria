<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Luz Diária - Devocional Completo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" referrerpolicy="no-referrer">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=Montserrat:wght@300;400;500;600&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&display=swap');

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #fdfbf7;
            color: #4a4a4a;
        }

        .serif { font-family: 'Lora', serif; }
        .script-font { font-family: 'Dancing Script', cursive; }

        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .custom-checkbox:checked + label span {
            text-decoration: line-through;
            color: #9ca3af;
        }

        .breathing-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(from 180deg at 50% 50%, #fcd34d 0deg, #f59e0b 180deg, #fcd34d 360deg);
            opacity: 0.8;
            filter: blur(15px);
            transition: transform 4s ease-in-out;
            margin: 0 auto;
        }
        .breathing-active {
            animation: breathe 8s infinite ease-in-out;
        }
        @keyframes breathe {
            0%, 100% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.9; }
        }

        .bible-book {
            transition: all 0.2s;
            font-size: 0.65rem; 
            text-align: center;
            line-height: 1.1;
            padding: 4px 2px;
            min-height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: break-word;
        }
        .bible-book.read {
            background-color: #d97706; /* amber-600 */
            color: white;
            border-color: #d97706;
        }

        .chapter-num {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background-color: #f3f4f6;
            color: #4b5563;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .chapter-num:hover, .chapter-num.active {
            background-color: #d97706;
            color: white;
        }
        .verse-text {
            font-family: 'Lora', serif;
            line-height: 1.8;
            margin-bottom: 12px;
        }
        .verse-num {
            font-size: 0.7em;
            color: #d97706;
            font-weight: bold;
            vertical-align: super;
            margin-right: 4px;
        }

        /* CORREÇÃO AQUI: Removido o background fixo do ID */
        #status-preview-container {
            width: 320px;
            height: 568px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            text-align: center;
            /* background removido para permitir que as classes funcionem */
        }
        .bg-gradient-1 { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); }
        .bg-gradient-2 { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }
        .bg-gradient-3 { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); }
        .bg-gradient-4 { background: linear-gradient(to top, #cfd9df 0%, #e2ebf0 100%); }
        .bg-gradient-5 { background: linear-gradient(45deg, #ff9a9e 0%, #fad0c4 99%, #fad0c4 100%); }
        
        .hidden { display: none !important; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center bg-[#fdfbf7]">

    <!-- TELA DE LOGIN -->
    <div id="login-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-[#fdfbf7] p-6 text-center transition-opacity duration-500">
        <div class="mb-10 relative">
            <div class="breathing-circle breathing-active w-40 h-40 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 opacity-50"></div>
            <div class="relative z-10 bg-white p-6 rounded-full shadow-sm border border-amber-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-amber-500" viewBox="0 0 512 512" fill="currentColor"><path d="M254.6 374.3c-2.3 0-4.6-.2-6.9-.5-49.8-7.4-89.6-47.5-96.8-97.4-2.1-14.7 10.5-27 25.1-24.9 49.8 7.4 89.6 47.5 96.8 97.4 2.1 14.7-10.5 27-25.1 24.9-.1.1-1.1.5-3.1.5zM226.7 8C218.4 9.3 213.3 17.8 215.3 26c11.3 45.3-15.1 92.2-60.4 103.5-8.2 2-16.7-3.1-18-11.4-1.3-8.3 3.9-16.7 12.1-18.7 27.5-6.9 43.6-35.4 36.7-62.9-2.1-8.3 3-16.8 11.3-18.1 1.7-.3 3.3-.3 5-.3 6.9 0 13.3 4.6 15 11.5-.2-1.6-1.1-1.1-1.3-1.6zm229.4 246.6c-5.8-23.7-22.1-43.2-44.4-53.1-23.9-10.6-51.1-7.3-71.9 8.7l-9.1-39.7c-4.6-20.3-13.8-39.2-26.9-55.2-13.6-16.6-30.8-29.7-50.2-38.3C187 56 109.8 63 60.1 123.5c-30 36.5-43.6 84.1-37.1 130.3 3.3 23.9 11.5 46.5 23.7 66.2l3.4 5.3c23.5 35.8 72.3 45.5 107.8 21.2.7-.5 1.4-1 2.1-1.5l29.4 128.5c4.7 20.6 25 33.3 45.6 28.6l75.4-17.3c20.6-4.7 33.3-25 28.6-45.6l-20.7-90.4c17.5 7.6 37 9.8 56 6.3 36.2-6.6 63.8-37 66.8-73.9.1-1.6.2-3.1.2-4.6z"/></svg>
            </div>
        </div>
        
        <h1 class="text-4xl font-bold text-amber-800 serif mb-2">Luz Diária</h1>
        <p id="status" class="text-gray-500 mb-12 font-light">Carregando...</p>

        <button id="btnLogin" class="flex items-center justify-center gap-3 bg-white border border-gray-300 text-gray-700 px-8 py-3 rounded-full shadow-sm hover:bg-gray-50 hover:shadow-md transition w-full max-w-xs font-medium">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" class="w-5 h-5">
            Entrar com Google
        </button>
        
        <p class="mt-8 text-xs text-gray-400">Ao entrar, seus dados serão sincronizados<br>para que você nunca perca suas orações.</p>
    </div>

    <!-- CONTEÚDO DO APP -->
    <div id="app-content" class="w-full flex flex-col items-center hidden pb-[90px]">
        
        <header class="w-full bg-white/90 backdrop-blur-md shadow-sm py-4 px-4 text-center sticky top-0 z-40 transition-all duration-300">
            <div class="max-w-md mx-auto flex justify-between items-center">
                <div class="text-left">
                    <h1 class="text-xl font-bold text-amber-700 tracking-wide serif">Luz Diária</h1>
                    <p class="text-[10px] text-gray-500 uppercase tracking-widest" id="current-date">Carregando...</p>
                </div>
                <div class="flex gap-3 items-center">
                    <button onclick="toggleFavoritesModal()" class="text-amber-700 hover:bg-amber-50 p-2 rounded-full transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                    </button>
                    <div class="relative">
                        <button onclick="toggleUserMenu()" class="focus:outline-none">
                            <img id="user-avatar" src="https://via.placeholder.com/32" alt="User" class="w-8 h-8 rounded-full border border-amber-200 object-cover">
                        </button>
                        <div id="user-menu" class="absolute right-0 top-12 bg-white shadow-xl rounded-xl p-2 w-32 border border-gray-100 hidden z-50 transform origin-top-right transition-all">
                            <button id="btnLogout" class="flex items-center gap-2 w-full text-left px-3 py-2 text-sm text-red-500 hover:bg-red-50 rounded-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                                Sair
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="w-full max-w-md px-4 mt-4 relative flex-grow">

            <!-- TAB: INÍCIO -->
            <div id="tab-home" class="tab-content fade-in space-y-6">
                <section>
                    <h2 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 ml-1">Como está seu coração?</h2>
                    <div class="flex flex-wrap gap-2" id="mood-buttons"></div>
                </section>

                <section id="verse-card" class="glass-card rounded-2xl shadow-lg p-6 text-center relative overflow-hidden border-t-4 border-amber-400 transition-all duration-300">
                    <button onclick="toggleFavoriteCurrent()" id="btn-favorite" class="absolute top-4 right-4 text-gray-300 hover:text-red-500 transition z-10">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                    </button>
                    <div class="absolute top-0 left-0 p-3 opacity-10 text-amber-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="currentColor" viewBox="0 0 24 24"><path d="M14.017 21L14.017 18C14.017 16.8954 13.1216 16 12.017 16H9.017C7.91243 16 7.017 16.8954 7.017 18V21H2.017V8.99992C2.017 8.99992 2.017 8.99992 2.017 8.99992V6.00002C2.017 4.89545 2.91243 4.00002 4.017 4.00002H9.017C10.1216 4.00002 11.017 4.89545 11.017 6.00002V9.00002C11.017 10.1046 10.1216 11 9.017 11H4.017V13.9999C4.017 14.2029 4.04359 14.3999 4.09355 14.5879C4.19799 14.9806 4.55523 15.2651 4.9622 15.2651H6.017V18C6.017 18.5523 6.46471 19 7.017 19H12.017C12.5693 19 13.017 18.5523 13.017 18V15H17.017V18C17.017 18.5523 17.4647 19 18.017 19H21.017V12.2323C21.017 11.6983 20.8242 11.1823 20.4727 10.7716L16.4727 6.09636C16.1557 5.726 15.6883 5.51217 15.2001 5.51217H14.017V2.51217C14.017 2.23603 14.2409 2.01217 14.517 2.01217H19.517C20.8977 2.01217 22.017 3.13146 22.017 4.51217V21H14.017Z" /></svg>
                    </div>
                    <div id="verse-content" class="mt-2 mb-4">
                        <p class="text-lg md:text-xl serif text-gray-800 leading-relaxed italic mb-3" id="verse-text">"..."</p>
                        <p class="text-xs font-bold text-amber-700 uppercase tracking-wide" id="verse-ref">...</p>
                    </div>
                    <div class="flex flex-wrap justify-center gap-2">
                        <button onclick="copyToClipboard()" class="icon-btn bg-gray-100 text-gray-600 w-10 h-10 rounded-full flex items-center justify-center hover:bg-gray-200 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        </button>
                        <button onclick="openShareModal()" class="icon-btn bg-green-500 text-white w-10 h-10 rounded-full flex items-center justify-center hover:bg-green-600 transition shadow-lg shadow-green-200">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                        </button>
                        <button onclick="shareNative()" class="icon-btn bg-amber-500 text-white w-10 h-10 rounded-full flex items-center justify-center hover:bg-amber-600 transition shadow-lg shadow-amber-200">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
                        </button>
                    </div>
                </section>

                <section class="bg-white rounded-2xl shadow-sm p-5 border border-gray-100">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-base font-semibold text-gray-700 serif">Pedidos de Oração</h2>
                        <span class="text-[10px] text-gray-400 bg-gray-50 px-2 py-1 rounded">Privado</span>
                    </div>
                    <div class="flex gap-2 mb-4">
                        <input type="text" id="prayer-input" placeholder="Novo pedido..." class="input-base flex-1">
                        <button onclick="addPrayer()" class="text-amber-600 hover:text-amber-800 px-2 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                        </button>
                    </div>
                    <ul id="prayer-list" class="space-y-2 text-sm"></ul>
                </section>
            </div>

            <!-- TAB: MEDITAR -->
            <div id="tab-meditate" class="tab-content hidden fade-in text-center py-6">
                <h2 class="text-xl font-semibold text-gray-700 serif mb-2">Momento de Paz</h2>
                <p class="text-xs text-gray-400 mb-8">Respire fundo. Acalme a alma.</p>
                <div class="relative w-64 h-64 mx-auto mb-8 flex items-center justify-center">
                    <div id="breathing-bg" class="breathing-circle absolute"></div>
                    <div class="z-10 text-4xl font-light text-gray-700 serif" id="timer-display">05:00</div>
                </div>
                <div class="flex justify-center gap-3 mb-8">
                    <button onclick="setTimer(5)" class="px-4 py-2 rounded-full bg-white border border-gray-200 text-sm hover:border-amber-400 transition">5 min</button>
                    <button onclick="setTimer(10)" class="px-4 py-2 rounded-full bg-white border border-gray-200 text-sm hover:border-amber-400 transition">10 min</button>
                    <button onclick="setTimer(15)" class="px-4 py-2 rounded-full bg-white border border-gray-200 text-sm hover:border-amber-400 transition">15 min</button>
                </div>
                <div class="flex justify-center items-center gap-6 mb-8">
                    <button onclick="toggleTimer()" id="btn-play-pause" class="w-16 h-16 bg-amber-600 text-white rounded-full shadow-lg text-2xl hover:bg-amber-700 transition flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 ml-1" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    </button>
                    <button onclick="resetTimer()" class="text-gray-400 hover:text-gray-600 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                    </button>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm mx-4">
                    <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Som de Fundo</p>
                    <div class="flex justify-center gap-4">
                        <button onclick="toggleSound('rain')" class="sound-btn flex flex-col items-center gap-1 text-gray-400 hover:text-blue-500 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" /></svg>
                            <span class="text-[10px]">Chuva</span>
                        </button>
                        <button onclick="toggleSound('off')" class="sound-btn flex flex-col items-center gap-1 text-amber-600 transition font-bold">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" stroke-miterlimit="10" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" /></svg>
                            <span class="text-[10px]">Silêncio</span>
                        </button>
                    </div>
                </div>
                <audio id="audio-rain" loop preload="none"><source src="https://actions.google.com/sounds/v1/weather/rain_heavy_loud.ogg" type="audio/ogg"></audio> 
            </div>

            <!-- TAB: LEITURA -->
            <div id="tab-reading" class="tab-content hidden fade-in pb-10">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-700 serif">Bíblia Sagrada</h2>
                    <div class="text-xs text-amber-600 font-bold bg-amber-50 px-3 py-1 rounded-full"><span id="reading-progress">0</span>% Lido</div>
                </div>
                <div class="space-y-6">
                    <div class="bg-white rounded-xl shadow-sm p-4">
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Antigo Testamento</h3>
                        <div class="grid grid-cols-4 sm:grid-cols-5 gap-2" id="ot-grid"></div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-4">
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Novo Testamento</h3>
                        <div class="grid grid-cols-4 sm:grid-cols-5 gap-2" id="nt-grid"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: GRATIDÃO -->
            <div id="tab-journal" class="tab-content hidden fade-in">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-700 serif">Diário de Gratidão</h2>
                    <span class="text-xs text-gray-400 bg-gray-50 px-2 py-1 rounded">Memórias</span>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-4 mb-6">
                    <p class="text-sm text-gray-500 mb-2">Pelo que você é grato hoje?</p>
                    <div class="flex gap-2">
                        <input type="text" id="journal-input" placeholder="Ex: Pelo sorriso do meu filho..." class="input-base flex-1">
                        <button onclick="addJournalEntry()" class="text-pink-500 hover:text-pink-700 px-2 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                        </button>
                    </div>
                </div>
                <div id="journal-list" class="space-y-4"></div>
            </div>

        </main>

        <nav class="fixed bottom-0 w-full bg-white border-t border-gray-200 py-2 px-6 flex justify-between items-center z-50 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] text-gray-400 text-[10px] font-medium max-w-md mx-auto left-0 right-0 md:rounded-t-2xl">
            <button onclick="switchTab('home')" class="nav-btn active flex flex-col items-center gap-1 p-2 w-16 text-amber-600" data-target="home">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3L4 9v12h5v-7h6v7h5V9z"/></svg> Início
            </button>
            <button onclick="switchTab('meditate')" class="nav-btn flex flex-col items-center gap-1 p-2 w-16 hover:text-amber-500" data-target="meditate">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a10 10 0 1010 10A10 10 0 0012 2zm0 18a8 8 0 118-8 8 8 0 01-8 8zm1-13h-2v6l5.25 3.15.75-1.23-4-2.37z"/></svg> Meditar
            </button>
            <button onclick="switchTab('reading')" class="nav-btn flex flex-col items-center gap-1 p-2 w-16 hover:text-amber-500" data-target="reading">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H8V4h12v12z"/></svg> Bíblia
            </button>
            <button onclick="switchTab('journal')" class="nav-btn flex flex-col items-center gap-1 p-2 w-16 hover:text-amber-500" data-target="journal">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg> Gratidão
            </button>
        </nav>
    </div>

    <!-- MODAL LEITOR -->
    <div id="bible-modal" class="fixed inset-0 bg-white z-[60] hidden flex flex-col overflow-hidden">
        <div class="flex justify-between items-center p-4 border-b border-gray-100 bg-white shadow-sm">
            <h2 id="reader-title" class="text-lg font-bold text-amber-800 serif">Gênesis</h2>
            <div class="flex items-center gap-3">
                <button onclick="toggleBookReadStatus()" id="btn-mark-read" class="text-xs font-semibold px-3 py-1 rounded-full border border-gray-300 text-gray-500 transition">Marcar Lido</button>
                <button onclick="closeBibleModal()" class="text-gray-500 p-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            </div>
        </div>
        <div class="flex-grow overflow-y-auto p-4 bg-[#fdfbf7]" id="bible-content-area">
            <div id="chapter-selection" class="fade-in">
                <p class="text-sm text-gray-500 mb-4 text-center">Escolha um capítulo para ler:</p>
                <div class="grid grid-cols-5 gap-3" id="chapters-grid"></div>
            </div>
            <div id="chapter-text-view" class="hidden fade-in">
                <div class="flex justify-between items-center mb-6">
                    <button onclick="showChapterSelection()" class="text-amber-600 text-sm flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg> Voltar</button>
                    <span id="current-chapter-display" class="text-sm font-bold text-gray-400">Cap. 1</span>
                </div>
                <div id="bible-text-body" class="text-gray-800 text-lg leading-relaxed serif pb-20">
                    <div class="text-center py-10"><i class="fas fa-spinner fa-spin text-amber-500 text-2xl"></i><p class="text-xs text-gray-400 mt-2">Carregando...</p></div>
                </div>
                <div class="flex justify-center gap-4 mt-8 pb-8">
                     <button onclick="prevChapter()" id="btn-prev-chapter" class="bg-gray-100 text-gray-600 px-4 py-3 rounded-full font-semibold hover:bg-gray-200 transition hidden">Anterior</button>
                     <button onclick="nextChapter()" id="btn-next-chapter" class="bg-amber-100 text-amber-800 px-6 py-3 rounded-full font-semibold hover:bg-amber-200 transition">Próximo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- OUTROS MODAIS -->
    <div id="favorites-modal" onclick="if(event.target === this) toggleFavoritesModal()" class="fixed inset-0 bg-black/50 z-[60] hidden flex justify-end transition-opacity cursor-pointer">
        <div class="bg-white w-3/4 max-w-sm h-full shadow-2xl p-6 overflow-y-auto transform translate-x-full transition-transform duration-300 cursor-default" id="favorites-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-lg font-bold text-amber-800 serif">Versículos Salvos</h2>
                <button onclick="toggleFavoritesModal()" class="text-gray-400 hover:text-gray-600 p-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            </div>
            <ul id="favorites-list" class="space-y-4"></ul>
        </div>
    </div>

    <div id="share-modal" onclick="if(event.target === this) closeShareModal()" class="fixed inset-0 bg-black bg-opacity-90 z-[70] hidden flex flex-col items-center justify-center p-4 overflow-y-auto backdrop-blur-sm cursor-pointer">
        <div class="bg-white rounded-xl p-4 w-full max-w-sm relative cursor-default">
            <button onclick="closeShareModal()" class="absolute top-2 right-2 text-gray-400 p-2 hover:bg-gray-100 rounded-full transition"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            <h3 class="text-center font-bold text-gray-700 mb-4 text-sm uppercase tracking-wide">Prévia para Status</h3>
            <div class="flex justify-center gap-2 mb-4">
                <button onclick="changeCardBg('bg-gradient-1')" class="w-6 h-6 rounded-full bg-gradient-1 border border-gray-200"></button>
                <button onclick="changeCardBg('bg-gradient-2')" class="w-6 h-6 rounded-full bg-gradient-2 border border-gray-200"></button>
                <button onclick="changeCardBg('bg-gradient-3')" class="w-6 h-6 rounded-full bg-gradient-3 border border-gray-200"></button>
                <button onclick="changeCardBg('bg-gradient-4')" class="w-6 h-6 rounded-full bg-gradient-4 border border-gray-200"></button>
                <button onclick="changeCardBg('bg-gradient-5')" class="w-6 h-6 rounded-full bg-gradient-5 border border-gray-200"></button>
            </div>
            <div class="flex justify-center mb-4 overflow-hidden rounded-lg bg-gray-100 p-1">
                <!-- CORREÇÃO AQUI: ID sem cor fixa e Classes com cor inicial -->
                <div id="status-preview-container" class="rounded-lg scale-[0.8] origin-top bg-gradient-1">
                    <div class="absolute top-8 left-0 w-full text-center opacity-30 text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="currentColor" viewBox="0 0 24 24"><path d="M14.017 21L14.017 18C14.017 16.8954 13.1216 16 12.017 16H9.017C7.91243 16 7.017 16.8954 7.017 18V21H2.017V8.99992C2.017 8.99992 2.017 8.99992 2.017 8.99992V6.00002C2.017 4.89545 2.91243 4.00002 4.017 4.00002H9.017C10.1216 4.00002 11.017 4.89545 11.017 6.00002V9.00002C11.017 10.1046 10.1216 11 9.017 11H4.017V13.9999C4.017 14.2029 4.04359 14.3999 4.09355 14.5879C4.19799 14.9806 4.55523 15.2651 4.9622 15.2651H6.017V18C6.017 18.5523 6.46471 19 7.017 19H12.017C12.5693 19 13.017 18.5523 13.017 18V15H17.017V18C17.017 18.5523 17.4647 19 18.017 19H21.017V12.2323C21.017 11.6983 20.8242 11.1823 20.4727 10.7716L16.4727 6.09636C16.1557 5.726 15.6883 5.51217 15.2001 5.51217H14.017V2.51217C14.017 2.23603 14.2409 2.01217 14.517 2.01217H19.517C20.8977 2.01217 22.017 3.13146 22.017 4.51217V21H14.017Z" /></svg></div>
                    <div class="z-10 px-6 mt-20">
                        <p id="modal-verse-text" class="text-white text-2xl serif font-bold leading-relaxed drop-shadow-md">"..."</p>
                        <div class="w-12 h-1 bg-white mx-auto my-6 opacity-70 rounded"></div>
                        <p id="modal-verse-ref" class="text-white text-lg uppercase tracking-widest font-medium drop-shadow-sm">...</p>
                    </div>
                    <div class="absolute bottom-8 w-full text-center">
                        <p class="text-white text-opacity-80 script-font text-2xl">Luz Diária</p>
                    </div>
                </div>
            </div>
            <button onclick="downloadCard()" id="btn-download" class="w-full py-3 bg-amber-600 hover:bg-amber-700 text-white font-bold rounded-lg shadow-lg text-sm flex justify-center items-center gap-2 transition">Baixar Imagem</button>
            <button onclick="closeShareModal()" class="w-full py-3 mt-2 text-gray-500 hover:bg-gray-100 hover:text-gray-700 font-medium rounded-lg text-sm transition">Voltar</button>
        </div>
    </div>

    <div id="toast" class="fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-5 py-2 rounded-full shadow-lg text-xs font-medium opacity-0 pointer-events-none transition-opacity duration-300 z-[80] flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg> <span id="toast-msg">Mensagem</span>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, where, setDoc, doc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCanRiUCjD-yliLR1Xxc0JzSzlI-ZNPZSg",
            authDomain: "luz-diaria-a3372.firebaseapp.com",
            projectId: "luz-diaria-a3372",
            storageBucket: "luz-diaria-a3372.firebasestorage.app",
            messagingSenderId: "64913070661",
            appId: "1:64913070661:web:f23b461d8720c20313612c",
            measurementId: "G-6MMDFP1ELL"
        };

        let app, auth, db, analytics, provider;
        let isFirebaseActive = false;

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            analytics = getAnalytics(app);
            provider = new GoogleAuthProvider();
            isFirebaseActive = true;
        } catch (e) {
            console.error("Erro Firebase Init:", e);
            document.getElementById('status').textContent = "Erro de conexão. Verifique o console.";
        }

        const btnLogin = document.getElementById('btnLogin');
        const btnLogout = document.getElementById('btnLogout');
        const statusTxt = document.getElementById('status');

        let currentUser = null;
        let currentVerse = null;
        let favorites = [];
        let prayers = [];
        let journal = [];
        let readBooks = [];
        let timerInterval;
        let timeLeft = 300; 
        let isTimerRunning = false;
        let currentAudioElement = null;
        let currentSound = null;
        let activeBookId = null;
        let activeBookName = null;
        let activeChapter = 1;
        let activeBookTotalChapters = 0;

        // BANCO DE DADOS (60 Versículos)
        const verses = [
            { id: 1, text: "Tudo posso naquele que me fortalece.", ref: "Filipenses 4:13", tag: "força" },
            { id: 12, text: "Seja forte e corajoso! Não se apavore nem desanime.", ref: "Josué 1:9", tag: "força" },
            { id: 16, text: "O Senhor é a minha força e o meu escudo; nele o meu coração confia.", ref: "Salmos 28:7", tag: "força" },
            { id: 17, text: "Deus é o nosso refúgio e fortaleza, socorro bem presente na angústia.", ref: "Salmos 46:1", tag: "força" },
            { id: 18, text: "Mas os que esperam no Senhor renovarão as forças.", ref: "Isaías 40:31", tag: "força" },
            { id: 19, text: "Fortaleçam as mãos cansadas, firmem os joelhos vacilantes.", ref: "Isaías 35:3", tag: "força" },
            { id: 20, text: "O Senhor dá força ao seu povo; o Senhor abençoa com paz ao seu povo.", ref: "Salmos 29:11", tag: "força" },
            { id: 21, text: "A alegria do Senhor é a nossa força.", ref: "Neemias 8:10", tag: "força" },
            { id: 2, text: "Entregue o seu caminho ao Senhor; confie nele, e ele agirá.", ref: "Salmos 37:5", tag: "confiança" },
            { id: 22, text: "Confie no Senhor de todo o seu coração e não se apoie em seu próprio entendimento.", ref: "Provérbios 3:5", tag: "confiança" },
            { id: 23, text: "Bendito o homem que confia no Senhor, e cuja confiança é o Senhor.", ref: "Jeremias 17:7", tag: "confiança" },
            { id: 24, text: "Em qualquer tempo em que eu temer, confiarei em ti.", ref: "Salmos 56:3", tag: "confiança" },
            { id: 25, text: "O Senhor é bom, um refúgio em tempos de angústia. Ele protege os que nele confiam.", ref: "Naum 1:7", tag: "confiança" },
            { id: 26, text: "Elevo os meus olhos para os montes; de onde me vem o socorro? O meu socorro vem do Senhor.", ref: "Salmos 121:1-2", tag: "confiança" },
            { id: 27, text: "Aquietai-vos, e sabei que eu sou Deus.", ref: "Salmos 46:10", tag: "confiança" },
            { id: 3, text: "Não andem ansiosos por coisa alguma.", ref: "Filipenses 4:6", tag: "ansiedade" },
            { id: 6, text: "Lancem sobre ele toda a sua ansiedade, porque ele tem cuidado de vocês.", ref: "1 Pedro 5:7", tag: "ansiedade" },
            { id: 28, text: "Busquei o Senhor, e ele me respondeu; livrou-me de todos os meus temores.", ref: "Salmos 34:4", tag: "ansiedade" },
            { id: 29, text: "Quando a ansiedade já me dominava no íntimo, o teu consolo trouxe alívio à minha alma.", ref: "Salmos 94:19", tag: "ansiedade" },
            { id: 30, text: "Portanto, não se preocupem com o amanhã, pois o amanhã trará as suas próprias preocupações.", ref: "Mateus 6:34", tag: "ansiedade" },
            { id: 31, text: "A ansiedade no coração do homem o abate, mas uma boa palavra o alegra.", ref: "Provérbios 12:25", tag: "ansiedade" },
            { id: 32, text: "Vinde a mim, todos os que estais cansados e oprimidos, e eu vos aliviarei.", ref: "Mateus 11:28", tag: "ansiedade" },
            { id: 5, text: "O Senhor é o meu pastor; nada me faltará.", ref: "Salmos 23:1", tag: "paz" },
            { id: 14, text: "Pela manhã ouvirás a minha voz, ó Senhor.", ref: "Salmos 5:3", tag: "paz" },
            { id: 33, text: "Deixo-lhes a paz; a minha paz lhes dou. Não a dou como o mundo a dá.", ref: "João 14:27", tag: "paz" },
            { id: 34, text: "Tu guardarás em perfeita paz aquele cujo propósito está firme, porque em ti confia.", ref: "Isaías 26:3", tag: "paz" },
            { id: 35, text: "Em paz também me deitarei e dormirei, porque só tu, Senhor, me fazes habitar em segurança.", ref: "Salmos 4:8", tag: "paz" },
            { id: 36, text: "E a paz de Deus, que excede todo o entendimento, guardará os vossos corações.", ref: "Filipenses 4:7", tag: "paz" },
            { id: 37, text: "O Senhor te abençoe e te guarde; o Senhor faça resplandecer o seu rosto sobre ti.", ref: "Números 6:24-25", tag: "paz" },
            { id: 7, text: "Deem graças ao Senhor porque ele é bom.", ref: "Salmos 107:1", tag: "gratidão" },
            { id: 38, text: "Em tudo dai graças, porque esta é a vontade de Deus em Cristo Jesus para convosco.", ref: "1 Tessalonicenses 5:18", tag: "gratidão" },
            { id: 39, text: "Este é o dia que o Senhor fez; regozijemo-nos e alegremo-nos nele.", ref: "Salmos 118:24", tag: "gratidão" },
            { id: 40, text: "Bendize, ó minha alma, ao Senhor, e não te esqueças de nenhum de seus benefícios.", ref: "Salmos 103:2", tag: "gratidão" },
            { id: 41, text: "Entrai pelas portas dele com gratidão, e em seus átrios com louvor.", ref: "Salmos 100:4", tag: "gratidão" },
            { id: 42, text: "Tudo o que fizerem, seja em palavra ou em ação, façam-no em nome do Senhor Jesus.", ref: "Colossenses 3:17", tag: "gratidão" },
            { id: 43, text: "Graças a Deus pelo seu dom inefável!", ref: "2 Coríntios 9:15", tag: "gratidão" },
            { id: 8, text: "Mas os que esperam no Senhor renovarão as forças.", ref: "Isaías 40:31", tag: "cansaço" },
            { id: 9, text: "Venham a mim, todos os que estão cansados.", ref: "Mateus 11:28", tag: "cansaço" },
            { id: 44, text: "Ele fortalece o cansado e dá grande vigor ao que está sem forças.", ref: "Isaías 40:29", tag: "cansaço" },
            { id: 45, text: "Não nos cansemos de fazer o bem.", ref: "Gálatas 6:9", tag: "cansaço" },
            { id: 46, text: "A minha carne e o meu coração desfalecem; mas Deus é a fortaleza do meu coração.", ref: "Salmos 73:26", tag: "cansaço" },
            { id: 47, text: "Lançando sobre ele toda a vossa ansiedade, porque ele tem cuidado de vós.", ref: "1 Pedro 5:7", tag: "cansaço" },
            { id: 10, text: "Ainda que eu ande pelo vale da sombra da morte, não temerei.", ref: "Salmos 23:4", tag: "medo" },
            { id: 48, text: "O Senhor é a minha luz e a minha salvação; a quem temerei?", ref: "Salmos 27:1", tag: "medo" },
            { id: 49, text: "Não temas, porque eu sou contigo; não te assombres, porque eu sou o teu Deus.", ref: "Isaías 41:10", tag: "medo" },
            { id: 50, text: "Porque Deus não nos deu o espírito de temor, mas de fortaleza, e de amor, e de moderação.", ref: "2 Timóteo 1:7", tag: "medo" },
            { id: 51, text: "Quando eu estiver com medo, confiarei em ti.", ref: "Salmos 56:3", tag: "medo" },
            { id: 52, text: "O anjo do Senhor acampa-se ao redor dos que o temem, e os livra.", ref: "Salmos 34:7", tag: "medo" },
            { id: 11, text: "O amor é paciente, o amor é bondoso.", ref: "1 Coríntios 13:4", tag: "amor" },
            { id: 13, text: "Porque Deus amou o mundo de tal maneira.", ref: "João 3:16", tag: "amor" },
            { id: 53, text: "Nós o amamos a ele porque ele nos amou primeiro.", ref: "1 João 4:19", tag: "amor" },
            { id: 54, text: "Acima de tudo, porém, revistam-se do amor, que é o elo da perfeição.", ref: "Colossenses 3:14", tag: "amor" },
            { id: 55, text: "Ainda que eu falasse as línguas dos homens e dos anjos, e não tivesse amor, seria como o metal que soa.", ref: "1 Coríntios 13:1", tag: "amor" },
            { id: 56, text: "Porque sou eu que conheço os planos que tenho para vocês... planos de dar a vocês esperança.", ref: "Jeremias 29:11", tag: "esperança" },
            { id: 57, text: "Ora, a fé é a certeza daquilo que esperamos e a prova das coisas que não vemos.", ref: "Hebreus 11:1", tag: "esperança" },
            { id: 58, text: "Mas, quanto a mim, ficarei atento ao Senhor, esperando em Deus, o meu Salvador.", ref: "Miqueias 7:7", tag: "esperança" },
            { id: 59, text: "Alegrem-se na esperança, sejam pacientes na tribulação, perseverem na oração.", ref: "Romanos 12:12", tag: "esperança" },
            { id: 60, text: "O Senhor é a minha porção; por isso, esperarei nele.", ref: "Lamentações 3:24", tag: "esperança" }
        ];

        const bibleData = {
            ot: [
                { id: 'gn', name: 'Gênesis', chapters: 50 }, { id: 'ex', name: 'Êxodo', chapters: 40 }, { id: 'lv', name: 'Levítico', chapters: 27 }, { id: 'nm', name: 'Números', chapters: 36 }, { id: 'dt', name: 'Deuteronômio', chapters: 34 },
                { id: 'js', name: 'Josué', chapters: 24 }, { id: 'jz', name: 'Juízes', chapters: 21 }, { id: 'rt', name: 'Rute', chapters: 4 }, { id: '1sm', name: '1 Samuel', chapters: 31 }, { id: '2sm', name: '2 Samuel', chapters: 24 },
                { id: '1rs', name: '1 Reis', chapters: 22 }, { id: '2rs', name: '2 Reis', chapters: 25 }, { id: '1cr', name: '1 Crônicas', chapters: 29 }, { id: '2cr', name: '2 Crônicas', chapters: 36 }, { id: 'ed', name: 'Esdras', chapters: 10 },
                { id: 'ne', name: 'Neemias', chapters: 13 }, { id: 'et', name: 'Ester', chapters: 10 }, { id: 'job', name: 'Jó', chapters: 42 }, { id: 'sl', name: 'Salmos', chapters: 150 }, { id: 'pv', name: 'Provérbios', chapters: 31 },
                { id: 'ec', name: 'Eclesiastes', chapters: 12 }, { id: 'ct', name: 'Cantares', chapters: 8 }, { id: 'is', name: 'Isaías', chapters: 66 }, { id: 'jr', name: 'Jeremias', chapters: 52 }, { id: 'lm', name: 'Lamentações', chapters: 5 },
                { id: 'ez', name: 'Ezequiel', chapters: 48 }, { id: 'dn', name: 'Daniel', chapters: 12 }, { id: 'os', name: 'Oseias', chapters: 14 }, { id: 'jl', name: 'Joel', chapters: 3 }, { id: 'am', name: 'Amós', chapters: 9 },
                { id: 'ob', name: 'Obadias', chapters: 1 }, { id: 'jn', name: 'Jonas', chapters: 4 }, { id: 'mq', name: 'Miqueias', chapters: 7 }, { id: 'na', name: 'Naum', chapters: 3 }, { id: 'hc', name: 'Habacuque', chapters: 3 },
                { id: 'sf', name: 'Sofonias', chapters: 3 }, { id: 'ag', name: 'Ageu', chapters: 2 }, { id: 'zc', name: 'Zacarias', chapters: 14 }, { id: 'ml', name: 'Malaquias', chapters: 4 }
            ],
            nt: [
                { id: 'mt', name: 'Mateus', chapters: 28 }, { id: 'mc', name: 'Marcos', chapters: 16 }, { id: 'lc', name: 'Lucas', chapters: 24 }, { id: 'jo', name: 'João', chapters: 21 }, { id: 'at', name: 'Atos', chapters: 28 },
                { id: 'rm', name: 'Romanos', chapters: 16 }, { id: '1co', name: '1 Coríntios', chapters: 16 }, { id: '2co', name: '2 Coríntios', chapters: 13 }, { id: 'gl', name: 'Gálatas', chapters: 6 }, { id: 'ef', name: 'Efésios', chapters: 6 },
                { id: 'fp', name: 'Filipenses', chapters: 4 }, { id: 'cl', name: 'Colossenses', chapters: 4 }, { id: '1ts', name: '1 Tessalonicenses', chapters: 5 }, { id: '2ts', name: '2 Tessalonicenses', chapters: 3 }, { id: '1tm', name: '1 Timóteo', chapters: 6 },
                { id: '2tm', name: '2 Timóteo', chapters: 4 }, { id: 'tt', name: 'Tito', chapters: 3 }, { id: 'fm', name: 'Filemom', chapters: 1 }, { id: 'hb', name: 'Hebreus', chapters: 13 }, { id: 'tg', name: 'Tiago', chapters: 5 },
                { id: '1pe', name: '1 Pedro', chapters: 5 }, { id: '2pe', name: '2 Pedro', chapters: 3 }, { id: '1jo', name: '1 João', chapters: 5 }, { id: '2jo', name: '2 João', chapters: 1 }, { id: '3jo', name: '3 João', chapters: 1 },
                { id: 'jd', name: 'Judas', chapters: 1 }, { id: 'ap', name: 'Apocalipse', chapters: 22 }
            ]
        };

        const moods = [
            { label: "Todos", tag: "all", color: "bg-gray-100 text-gray-600" },
            { label: "Ansioso", tag: "ansiedade", color: "bg-blue-100 text-blue-700" },
            { label: "Cansado", tag: "cansaço", color: "bg-orange-100 text-orange-700" },
            { label: "Grato", tag: "gratidão", color: "bg-pink-100 text-pink-700" },
            { label: "Medo", tag: "medo", color: "bg-purple-100 text-purple-700" },
            { label: "Paz", tag: "paz", color: "bg-teal-100 text-teal-700" },
            { label: "Amor", tag: "amor", color: "bg-red-100 text-red-700" },
            { label: "Esperança", tag: "esperança", color: "bg-yellow-100 text-yellow-700" }
        ];

        // CONFIGURAÇÃO DOS EVENTOS (Funções na Window para serem acessíveis pelo HTML)
        
        window.renderMoodButtons = () => {
            const container = document.getElementById('mood-buttons');
            if (container) {
                container.innerHTML = moods.map(m => `
                    <button onclick="filterVerse('${m.tag}')" class="${m.color} px-3 py-1.5 rounded-full text-[10px] font-bold uppercase transition hover:opacity-80 shadow-sm">
                        ${m.label}
                    </button>
                `).join('');
            }
        };

        window.renderDate = () => {
            const dateStr = new Date().toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
            document.getElementById('current-date').textContent = dateStr;
        };

        window.loadRandomVerse = () => {
            currentVerse = verses[Math.floor(Math.random() * verses.length)];
            window.updateVerseUI();
        };

        window.filterVerse = (tag) => {
            let list = tag === 'all' ? verses : verses.filter(v => v.tag === tag);
            if(list.length === 0) list = verses;
            currentVerse = list[Math.floor(Math.random() * list.length)];
            const card = document.getElementById('verse-card');
            card.classList.remove('fade-in'); void card.offsetWidth; card.classList.add('fade-in');
            window.updateVerseUI();
        };

        window.updateVerseUI = () => {
            document.getElementById('verse-text').textContent = `"${currentVerse.text}"`;
            document.getElementById('verse-ref').textContent = currentVerse.ref;
            const btn = document.getElementById('btn-favorite');
            const isFav = favorites.some(f => f.id === currentVerse.id);
            btn.className = isFav ? "absolute top-4 right-4 text-red-500 transition z-10" : "absolute top-4 right-4 text-gray-300 hover:text-red-500 transition z-10";
        };

        window.toggleFavoriteCurrent = () => {
            const idx = favorites.findIndex(f => f.id === currentVerse.id);
            if (idx === -1) { favorites.push(currentVerse); window.showToast("Salvo!"); }
            else { favorites.splice(idx, 1); window.showToast("Removido."); }
            window.saveUserData(); window.updateVerseUI(); window.renderFavoritesList();
        };

        window.renderFavoritesList = () => {
            const list = document.getElementById('favorites-list');
            if (favorites.length === 0) list.innerHTML = '<li class="text-xs text-gray-400 italic">Lista vazia.</li>';
            else list.innerHTML = favorites.map(f => `<li class="bg-amber-50 p-3 rounded-lg border border-amber-100 text-sm"><p class="text-gray-700 italic mb-1">"${f.text}"</p><span class="text-amber-700 font-bold text-xs">${f.ref}</span></li>`).join('');
        };

        window.toggleFavoritesModal = () => {
            const modal = document.getElementById('favorites-modal');
            const content = document.getElementById('favorites-content');
            if(modal.classList.contains('hidden')) { 
                window.renderFavoritesList(); 
                modal.classList.remove('hidden'); 
                document.body.style.overflow = 'hidden'; 
                setTimeout(() => content.classList.remove('translate-x-full'), 10); 
            } else { 
                content.classList.add('translate-x-full'); 
                setTimeout(() => { modal.classList.add('hidden'); document.body.style.overflow = ''; }, 300); 
            }
        };

        window.showToast = (m) => { 
            const t = document.getElementById('toast'); document.getElementById('toast-msg').textContent = m; t.classList.remove('opacity-0', 'pointer-events-none'); setTimeout(() => t.classList.add('opacity-0', 'pointer-events-none'), 3000); 
        };

        window.toggleTheme = () => window.showToast("Paz seja convosco.");

        // BIBLE READER
        window.renderBibleTracker = () => {
            const renderGrid = (books, containerId) => {
                document.getElementById(containerId).innerHTML = books.map(book => {
                    const isRead = readBooks.includes(book.id);
                    return `<div onclick="openBibleReader('${book.id}', '${book.name}', ${book.chapters})" 
                        class="bible-book ${isRead ? 'read' : 'bg-gray-100 text-gray-500'} 
                        h-10 rounded flex items-center justify-center font-bold cursor-pointer border border-transparent hover:border-amber-300">
                        ${book.name}
                    </div>`;
                }).join('');
            };
            renderGrid(bibleData.ot, 'ot-grid');
            renderGrid(bibleData.nt, 'nt-grid');
            window.updateProgress();
        };

        window.updateProgress = () => {
            const total = bibleData.ot.length + bibleData.nt.length;
            const read = readBooks.length;
            document.getElementById('reading-progress').textContent = Math.round((read / total) * 100);
        };

        window.openBibleReader = (bookId, bookName, totalChapters) => {
            activeBookId = bookId; activeBookName = bookName; activeBookTotalChapters = totalChapters;
            document.getElementById('reader-title').textContent = bookName;
            window.updateReadButtonStatus();
            const grid = document.getElementById('chapters-grid'); grid.innerHTML = '';
            for (let i = 1; i <= totalChapters; i++) {
                const div = document.createElement('div'); div.className = 'chapter-num'; div.textContent = i; div.onclick = () => window.loadChapterText(i); grid.appendChild(div);
            }
            window.showChapterSelection(); document.getElementById('bible-modal').classList.remove('hidden'); document.body.style.overflow = 'hidden';
        };

        window.updateReadButtonStatus = () => {
            const btn = document.getElementById('btn-mark-read'); const isRead = readBooks.includes(activeBookId);
            if (isRead) { btn.classList.add('bg-amber-600', 'text-white', 'border-transparent'); btn.classList.remove('text-gray-500', 'border-gray-300'); btn.textContent = "Lido ✓"; } 
            else { btn.classList.remove('bg-amber-600', 'text-white', 'border-transparent'); btn.classList.add('text-gray-500', 'border-gray-300'); btn.textContent = "Marcar Lido"; }
        };

        window.toggleBookReadStatus = () => {
            if (readBooks.includes(activeBookId)) readBooks = readBooks.filter(b => b !== activeBookId); else { readBooks.push(activeBookId); window.showToast("Livro concluído!"); }
            window.saveUserData(); window.updateReadButtonStatus(); window.renderBibleTracker();
        };

        window.closeBibleModal = () => { document.getElementById('bible-modal').classList.add('hidden'); document.body.style.overflow = ''; };
        window.showChapterSelection = () => { document.getElementById('chapter-selection').classList.remove('hidden'); document.getElementById('chapter-text-view').classList.add('hidden'); };
        
        window.loadChapterText = async (chapter) => {
            activeChapter = chapter; document.getElementById('chapter-selection').classList.add('hidden'); const textView = document.getElementById('chapter-text-view'); textView.classList.remove('hidden');
            document.getElementById('current-chapter-display').textContent = `Capítulo ${chapter}`;
            const prevBtn = document.getElementById('btn-prev-chapter'); const nextBtn = document.getElementById('btn-next-chapter');
            if (activeChapter <= 1) prevBtn.classList.add('hidden'); else prevBtn.classList.remove('hidden');
            if (activeChapter >= activeBookTotalChapters) nextBtn.classList.add('hidden'); else nextBtn.classList.remove('hidden');
            const body = document.getElementById('bible-text-body'); body.innerHTML = '<div class="text-center py-10"><i class="fas fa-spinner fa-spin text-amber-500 text-2xl"></i><p class="text-xs text-gray-400 mt-2">Buscando na nuvem...</p></div>'; document.getElementById('bible-content-area').scrollTop = 0;
            try {
                const url = `https://bible-api.com/${encodeURIComponent(activeBookName)}+${chapter}?translation=almeida`;
                const response = await fetch(url);
                if (!response.ok) throw new Error('Erro na API');
                const data = await response.json();
                let html = '';
                if (data.verses && data.verses.length > 0) html = data.verses.map(v => `<p class="verse-text"><sup class="verse-num">${v.verse}</sup> ${v.text}</p>`).join('');
                else html = '<p class="text-center text-gray-500 mt-10">Texto indisponível no momento.</p>';
                body.innerHTML = html;
            } catch (error) { console.error(error); body.innerHTML = '<div class="text-center py-10 text-red-400"><p>Erro ao carregar.</p><button onclick="loadChapterText('+chapter+')" class="mt-4 text-sm underline">Tentar novamente</button></div>'; }
        };
        window.nextChapter = () => { if (activeChapter < activeBookTotalChapters) window.loadChapterText(activeChapter + 1); };
        window.prevChapter = () => { if (activeChapter > 1) window.loadChapterText(activeChapter - 1); };

        // PRAYERS & JOURNAL
        window.renderPrayers = () => {
            const list = document.getElementById('prayer-list');
            if (prayers.length === 0) list.innerHTML = '<li class="text-xs text-center text-gray-400 italic">Nenhum pedido ainda.</li>';
            else list.innerHTML = prayers.slice().reverse().map(p => `<li class="flex items-center justify-between bg-gray-50 p-2 rounded border border-gray-100"><div class="flex items-center gap-2 overflow-hidden"><input type="checkbox" id="p-${p.id}" class="custom-checkbox w-3 h-3 text-amber-600 rounded" ${p.done ? 'checked' : ''} onchange="togglePrayer(${p.id})"><label for="p-${p.id}" class="cursor-pointer truncate"><span class="text-gray-700">${p.text}</span></label></div><button onclick="deletePrayer(${p.id})" class="text-gray-300 hover:text-red-400 px-2"><i class="fas fa-trash-alt text-[10px]"></i></button></li>`).join('');
        };
        window.addPrayer = () => { const val = document.getElementById('prayer-input').value.trim(); if(val) { prayers.push({id:Date.now(), text:val, done:false}); window.saveUserData(); document.getElementById('prayer-input').value=''; window.renderPrayers(); } };
        window.togglePrayer = (id) => { const p = prayers.find(x => x.id === id); if(p) { p.done = !p.done; window.saveUserData(); window.renderPrayers(); } };
        window.deletePrayer = (id) => { prayers = prayers.filter(x => x.id !== id); window.saveUserData(); window.renderPrayers(); };

        window.renderJournal = () => {
            const list = document.getElementById('journal-list');
            if (journal.length === 0) list.innerHTML = '<div class="text-center py-8"><i class="fas fa-book-open text-gray-200 text-4xl mb-2"></i><p class="text-xs text-gray-400">Comece seu diário hoje.</p></div>';
            else list.innerHTML = journal.slice().reverse().map(j => `<div class="bg-white p-3 rounded-lg shadow-sm border-l-4 border-pink-300"><div class="flex justify-between items-start"><span class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">${j.date}</span><button onclick="deleteJournal(${j.id})" class="text-gray-300 hover:text-red-400"><i class="fas fa-times"></i></button></div><p class="text-sm text-gray-600 mt-1 font-serif">"${j.text}"</p></div>`).join('');
        };
        window.addJournalEntry = () => { const val = document.getElementById('journal-input').value.trim(); if(val) { const date = new Date().toLocaleDateString('pt-BR'); journal.push({id:Date.now(), text:val, date:date}); window.saveUserData(); document.getElementById('journal-input').value=''; window.renderJournal(); window.showToast("Gratidão registrada."); } };
        window.deleteJournal = (id) => { journal = journal.filter(x => x.id !== id); window.saveUserData(); window.renderJournal(); };

        // UTILS
        window.openShareModal = () => { document.getElementById('modal-verse-text').textContent = `"${currentVerse.text}"`; document.getElementById('modal-verse-ref').textContent = currentVerse.ref; document.getElementById('share-modal').classList.remove('hidden'); document.body.style.overflow = 'hidden'; };
        window.closeShareModal = () => { document.getElementById('share-modal').classList.add('hidden'); document.body.style.overflow = ''; };
        
        // CORREÇÃO CRÍTICA AQUI: Usando classList para trocar cores sem perder o estilo base
        window.changeCardBg = (c) => { 
            const el = document.getElementById('status-preview-container'); 
            // Remove classes de gradiente antigas
            el.classList.remove('bg-gradient-1', 'bg-gradient-2', 'bg-gradient-3', 'bg-gradient-4', 'bg-gradient-5');
            // Adiciona a nova
            el.classList.add(c);
        };
        
        window.downloadCard = () => { const btn = document.getElementById('btn-download'); btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ...'; html2canvas(document.getElementById('status-preview-container'), { scale:2, useCORS:true, backgroundColor:null }).then(cv => { const a = document.createElement('a'); a.download = 'luz-diaria.png'; a.href = cv.toDataURL("image/png"); a.click(); btn.innerHTML = '<i class="fas fa-check"></i> Baixado!'; setTimeout(() => btn.innerHTML = '<i class="fas fa-download"></i> Baixar Imagem', 2000); }); }
        window.copyToClipboard = () => { navigator.clipboard.writeText(`${currentVerse.text} - ${currentVerse.ref}`).then(() => window.showToast("Copiado!")); };
        window.shareNative = () => { if (navigator.share) navigator.share({ title: 'Luz Diária', text: `${currentVerse.text} - ${currentVerse.ref}` }); else window.copyToClipboard(); };
        window.showToast = (m) => { const t = document.getElementById('toast'); document.getElementById('toast-msg').textContent = m; t.classList.remove('opacity-0', 'pointer-events-none'); setTimeout(() => t.classList.add('opacity-0', 'pointer-events-none'), 3000); }
        window.toggleTheme = () => { window.showToast("Paz seja convosco."); }
    </script>
</body>
</html>
